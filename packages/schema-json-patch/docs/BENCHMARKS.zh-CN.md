# 性能基准测试

`@waveox/schema-json-patch` 详细性能基准测试报告。

## 概览

| 功能                 | 场景             | 性能               |
| -------------------- | ---------------- | ------------------ |
| **generatePatches**  | 10 项, 少量变更  | ~10,750 ops/sec    |
| **generatePatches**  | 100 项, 20% 变更 | ~1,430 ops/sec     |
| **generatePatches**  | 500 项, 10% 变更 | ~310 ops/sec       |
| **applyPatches**     | 10 项, 少量补丁  | ~12,088 ops/sec    |
| **applyPatches**     | 100 项, 稀疏补丁 | ~326 ops/sec       |
| **detectConflicts**  | 2 组, 少量冲突   | ~13,672 ops/sec    |
| **detectConflicts**  | 5 组, 有冲突     | ~6,088 ops/sec     |
| **resolveConflicts** | 3 个冲突         | ~658,760 ops/sec   |
| **resolveConflicts** | 10 个冲突        | ~274,781 ops/sec   |
| **validatePatches**  | 10 个补丁        | ~2,601,370 ops/sec |
| **validateJson**     | 100 项           | ~6,947 ops/sec     |

---

## 详细结果

### 补丁生成 (`generatePatches`)

| 数据规模   | 场景     | ops/sec | 平均耗时 (ms) |
| ---------- | -------- | ------- | ------------- |
| 小 (10项)  | 少量变更 | 10,750  | 0.09          |
| 小 (10项)  | 全部修改 | 5,961   | 0.17          |
| 中 (100项) | 稀疏 20% | 1,430   | 0.70          |
| 中 (100项) | 密集 50% | 1,061   | 0.94          |
| 大 (500项) | 稀疏 10% | 310     | 3.20          |
| 大 (500项) | 全量     | 182     | 5.50          |

**顺序变化 (100项):**

| 场景     | ops/sec | 平均耗时 (ms) |
| -------- | ------- | ------------- |
| 完全打乱 | 1,253   | 0.80          |
| 反转顺序 | 1,302   | 0.77          |
| 部分重排 | 1,556   | 0.64          |

---

### 补丁应用 (`applyPatches`)

| 数据规模   | 场景        | ops/sec | 平均耗时 (ms) |
| ---------- | ----------- | ------- | ------------- |
| 小 (10项)  | 少量补丁    | 12,088  | 0.08          |
| 中 (100项) | 稀疏 (20处) | 326     | 3.07          |
| 中 (100项) | 密集 (全部) | 34      | 29.70         |
| 大 (500项) | 50 个补丁   | 25      | 39.70         |

**复杂操作 (100项):**

| 场景       | ops/sec | 平均耗时 (ms) |
| ---------- | ------- | ------------- |
| 添加 20 项 | 303     | 3.30          |
| 删除 20 项 | 327     | 3.06          |
| 混合操作   | 98      | 10.20         |

---

### 冲突检测 (`detectConflicts`)

| 场景           | ops/sec | 平均耗时 (ms) |
| -------------- | ------- | ------------- |
| 2 组, 无冲突   | 13,672  | 0.07          |
| 2 组, 部分冲突 | 14,091  | 0.07          |
| 2 组, 全部冲突 | 17,327  | 0.06          |
| 3 组, 有冲突   | 8,163   | 0.12          |
| 5 组, 有冲突   | 6,088   | 0.16          |

**大规模补丁 (每组 60 个补丁):**

| 场景      | ops/sec | 平均耗时 (ms) |
| --------- | ------- | ------------- |
| 无冲突    | 2,508   | 0.40          |
| 30 个冲突 | 2,577   | 0.39          |

---

### 冲突解决 (`resolveConflicts`)

| 场景           | ops/sec | 平均耗时 (μs) |
| -------------- | ------- | ------------- |
| 3 个冲突       | 658,760 | 1.5           |
| 10 个冲突      | 274,781 | 3.6           |
| 3 组冲突       | 464,680 | 2.2           |
| 自定义解决方案 | 457,968 | 2.2           |

---

### 验证功能

**validateJson:**

| 场景       | ops/sec | 平均耗时 (ms) |
| ---------- | ------- | ------------- |
| 小 (10项)  | 65,744  | 0.015         |
| 中 (100项) | 6,947   | 0.144         |
| 大 (500项) | 1,366   | 0.732         |
| 无效 JSON  | 89,915  | 0.011         |

**validatePatches:**

| 场景       | ops/sec   |
| ---------- | --------- |
| 10 个补丁  | 2,601,370 |
| 100 个补丁 | 372,355   |

---

## 扩展性分析

| 数据量 | 耗时 (ms) | 每项耗时 (μs) | 扩展因子 |
| ------ | --------- | ------------- | -------- |
| 10     | 0.09      | 9.4           | 1.00x    |
| 100    | 0.70      | 7.0           | 0.74x    |
| 500    | 3.20      | 6.4           | 0.68x    |

> [!TIP]
> 随着数据量增长，扩展因子反而降低，这表明每项的处理时间实际上在**减少**，这证明了库具备 **O(n) 线性复杂度**。

---

## 运行基准测试

```bash
# 运行所有测试
pnpm vitest bench --run

# 运行特定类别
pnpm vitest bench --run benchmarks/generate/
pnpm vitest bench --run benchmarks/apply/
pnpm vitest bench --run benchmarks/detect/
pnpm vitest bench --run benchmarks/resolve/
pnpm vitest bench --run benchmarks/validate/
```

_测试环境: Linux, Node.js v22+_  
_更新日期: 2025-12-29_
